<script type="text/javascript" src="{lib file=uploader.js}" charset="utf-8"></script>
<script type="text/javascript">
var _d = DialogManager.get('config_dialog');
_d.setWidth(400);
_d.setPosition('center');

$('#add_image').click(function(){
    $fileLen = $('.fileImg').length;
    $(this).before('<div class="field_item fileImg">' +
        '<label>上传图片:(<span>支持 gif|jpg|jpeg|png 格式, 263px * 401px</span>)</label>' +
        '<p><div id="filePicker'+$fileLen+'">选择图片</div><input type="hidden" name="zg_image_url[]" id="zg_image_url'+$fileLen+'" value="" /></p>'+
        '<p id="fileList'+$fileLen+'"></p>' +
	'<label>图片标题:</label>' +
        '<p style="overflow:hidden;"><input type="text" name="zg_title[]" value="" />' +
        '<label>市场价:</label>' +
        '<p style="overflow:hidden;"><input type="text" name="zg_priceold[]" value="" />' +
        '<label>现价:</label>' +
        '<p style="overflow:hidden;"><input type="text" name="zg_price[]" value="" />' +
        '<label>链接地址:</label>' +
        '<p style="overflow:hidden;"><input type="text" name="zg_link_url[]" value="" />' +
        '<input type="button" value="删除商品" onclick="drop_image(this)" /></p></div>');
    uploadImg('fileList'+$fileLen,'filePicker'+$fileLen,'zg_image_url'+$fileLen,40,40);
});
function drop_image(btnObj)
{
    $(btnObj).parents('.field_item').remove();
}
</script>
<div style="height:500px;overflow:scroll;">
<!-- {if $options.goods_list} -->
<!-- {foreach from=$options.goods_list item=goods key=key} -->
<div class="field_item fileImg">
    <label>上传图片:(<span>支持 gif|jpg|jpeg|png 格式, 263px * 401px</span>)</label>
    <p><div id="filePicker{$key}">选择图片</div>
    <input type="hidden" name="zg_image_url[]" id="zg_image_url{$key}" value="{$goods.zg_image_url}" /></p>
    <p id="fileList{$key}"><img src="{$goods.zg_image_url}" height="40" /></p>
    <label>图片标题:</label>
    <p style="overflow:hidden;"><input type="text" name="zg_title[]" value="{$goods.zg_title}" />
    <label>市场价:</label>
    <p style="overflow:hidden;"><input type="text" name="zg_priceold[]" value="{$goods.zg_priceold}" />
    <label>现价:</label>
    <p style="overflow:hidden;"><input type="text" name="zg_price[]" value="{$goods.zg_price}" />
    <label>链接地址:</label>
    <p style="overflow:hidden;"><input type="text" name="zg_link_url[]" value="{$goods.zg_link_url}" />
    <input  type="button" value="删除商品" onclick="drop_image(this)" /></p>
</div>
<!-- {/foreach} -->
<!-- {else} -->
<div class="field_item fileImg">
    <label>上传图片:(<span>支持 gif|jpg|jpeg|png 格式  263px * 401px</span>)</label>
    <p><div id="filePicker0">选择图片</div><input type="hidden" name="zg_image_url[]" id="zg_image_url0" value="" /></p>
    <p id="fileList0"></p>
    <label>图片标题:</label>
    <p style="overflow:hidden;"><input type="text" name="zg_title[]" value="" />
    <label>市场价:</label>
    <p style="overflow:hidden;"><input type="text" name="zg_priceold[]" value="" />
    <label>现价:</label>
    <p style="overflow:hidden;"><input type="text" name="zg_price[]" value="" />
    <label>链接地址:</label>
    <p style="overflow:hidden;"><input type="text" name="zg_link_url[]" value="" />
    <input type="button" value="删除商品" onclick="drop_image(this)" /></p>
</div>
<!-- {/if} -->
<input type="button" id="add_image" value="新增商品" />
</div>
<script type="text/javascript">
    $(function(){
        <!--{if $options.goods_list}-->
        <!-- {foreach from=$options.goods_list item=goods key=key} -->
        uploadImg('fileList{$key}','filePicker{$key}','zg_image_url{$key}',40,40);
        <!-- {/foreach} -->
        <!--{else}-->
        uploadImg('fileList0','filePicker0','zg_image_url0',40,40);
        <!-- {/if} -->
    });
</script>